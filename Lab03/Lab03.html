<!DOCTYPE html>
<html>
    <head>
        <title>Lab03</title>
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
            crossorigin=""/>
            <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
            crossorigin=""></script>
    </head> 
    <script src="https://electionmaps.github.io/coviddata.js"></script>
    <script src="https://michaelleiting13.github.io/provinces.js"></script>     
    <body>
        <div id="map"></div>
        <script type="text/javascript">
            var map = L.map('map', {
            center: [34.666, 104.9569],
            zoom: 5
            });
            
            var terrain = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
		    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                subdomains: 'abcd',
                minZoom: 0,
                maxZoom: 18,
                ext: 'png'
            });
            var canvas = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
		    attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
                subdomains: 'abcd',
                minZoom: 0,
                maxZoom: 18,
                ext: 'png'
            }).addTo(map);
            var minValue = 100;
            var minRadius = 5;
            //adjust to determine scaling
            function calcRadius(val) {
                return 0.9 * Math.pow(val/minValue, 0.7) * minRadius;
            }
            var covidData = new L.geoJson(covidData,{
                onEachFeature: onEachFeature,
                pointToLayer: function(feature, latlng){
                    return L.circleMarker(latlng, {
                        color: 'FF0000',
                        opacity: 1,
                        weight: 2,
                        fillColor: '#FF0000',
                        fillOpacity: 0.5,
                        //radius: 10
                        radius: calcRadius(feature.properties.covid)
                    });
                }
            }).addTo(map);
            var provinces = L.geoJson(provinces, {style:style}).addTo(map)
                function getColor(value) {               
                    return value > 50000000 ? '#54278f':
                        value > 25000000 ? '#756bb1':
                        value > 10000000 ? '#9e9ac8':
                        value > 5000000 ? '#cbc9e2':
                        '#f2f0f7';
                }
                function style(feature){
                    return {
                        fillColor: getColor(feature.properties.POP10),
                        weight: 2,
                        opacity: 1,
                        color: 'gray',
                        fillOpacity: 0.9
                    };
                }
            var basemaps = {
                "Light Canvas": canvas, 
                "Satellite Imagery": terrain};
            var overlaymaps = {
                "Covid Cases": covidData, 
                "Provinces": provinces};
            L.control.layers(basemaps, overlaymaps, {collapsed:false}).addTo(map);
            var legend = L.control({position: 'bottomleft'});
                legend.onAdd = function (map) {
                    var div = L.DomUtil.create('div', 'legend'),
                    grades = [0, 1000000, 2000000, 5000000, 10000000];
                    div.innerHTML = '<b>Population 2019 >br><br></b>'; //legend title
                    for(var i = 0; i < grades.length; i++) {
                        div,innerHTML +-
                            '<i style="background:' + getColor(grades[i] + 1) + '"></i>' +
                            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
                    }
                    return div;
                };
            var onEachFeature = function(feature, layer){
                if(feature.properties){
                    var prop = feature.properties;
                    //make html popup with properties
                    //see how you can concatenate various attributes and text as needed, including html markup, with single quotes. Pull out properties by typing in prop and then putting the field in brackets.
                    //you can do this because prop = feature.properties
                    var popup = '<h3>'+prop['Location']+'</h3>'+'<br>Cases Day 1:'+prop['1']+'<br>Cases Day 16: '+prop['Covid'];
                    //add known infro about event to description
                    //must create a layer property on each feature or else
                    //search results wont know where item is on map or layer
                    feature.layer = layer;
                    layer.bindPopup(popup, {maxWidth: "auto"});
                }
            };
            legend.addTo(map);
            //remove legend when layer removed
            map.on('overlayremove', function (eventLayer) {
                if (eventLayer.name == 'Provinces') { //We use the key/display name to refer to the layer
                    map.removeControl(legend); //legend is variable name of layer legend
                }
            });

            //add legend when layer added
            map.on('overlayadd', function (eventLayer) {
                if (eventLayer.name == 'Provinces'){
                    legend.addTo(map);
                }
            });
        </script>
            <style type="text/css">
                html, body { margin: 0; padding: 0; height: 100%; }
                #map { min-height: 100%; }
                    .legend {
                        padding: 6px 9px;
                        line-height: 18px;
                        background: rgba(255,255,255,0.9);
                        box-shadow: 0 0 15px rgba(0,0,0,0.2);
                        border-radius: 5px;
                    }
                    /* adjust values to change apperance of legend color boxes */
                    .legend I {
                        width: 18px;
                        height: 18px;
                        float: left;
                        margin-right: 8px;
                        opacity: 0.7;
                    }
            </style>
    </body>
</html>